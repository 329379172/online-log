{"version":3,"sources":["../../src/service/user.js"],"names":["db","require","md5","createUser","username","password","test","Error","length","now","Date","user","lastTime","token","createTime","url","smartyAddAsync","tableName","model","getUserByUsername","findAsync","where","getUserById","id","parseInt","getUserByToken","module","exports"],"mappings":";;;;;;;;;;;;AAIA,IAAIA,KAAKC,QAAQ,MAAR,CAAT;AACA,IAAIC,MAAMD,QAAQ,aAAR,CAAV;;AAEA,IAAIE;AAAA,0EAAa,iBAAMC,QAAN,EAAgBC,QAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AACbD,mCAAWA,YAAY,EAAvB;;AADa,4BAER,WAAWE,IAAX,CAAgBF,QAAhB,CAFQ;AAAA;AAAA;AAAA;;AAAA,8BAGH,IAAIG,KAAJ,wGAHG;;AAAA;AAKbF,mCAAWA,YAAY,EAAvB;;AALa,8BAMTA,SAASG,MAAT,GAAkB,CAAlB,IAAuBH,SAASG,MAAT,GAAkB,EANhC;AAAA;AAAA;AAAA;;AAAA,8BAOH,IAAID,KAAJ,4CAPG;;AAAA;AASTE,2BATS,GASHC,KAAKD,GAAL,EATG;AAUTE,4BAVS,GAUF;AACPP,sCAAUA,QADH;AAEPC,sCAAUH,IAAIG,QAAJ,CAFH;AAGPO,sCAAUH,GAHH;AAIPI,mCAAOX,IAAOE,QAAP,SAAmBC,QAAnB,SAA+BK,KAAKD,GAAL,EAA/B,CAJA;AAKPK,wCAAYL,GALL;AAMPM,uCAASX;AANF,yBAVE;AAAA;AAAA,+BAkBPJ,GAAGgB,cAAH,CAAkB;AACpBC,uCAAW,QADS;AAEpBC,mCAAOP;AAFa,yBAAlB,CAlBO;;AAAA;AAAA,+DAsBFP,QAtBE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAb;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AA0BA,IAAIe;AAAA,2EAAoB,kBAAMf,QAAN;AAAA;AAAA;AAAA;AAAA;AACpBA,mCAAWA,YAAY,EAAvB;;AADoB,8BAEhBA,YAAY,EAFI;AAAA;AAAA;AAAA;;AAAA,0DAGT,EAHS;;AAAA;AAAA;AAAA,+BAKPJ,GAAGoB,SAAH,CAAa;AACtBH,uCAAW,QADW;AAEtBI,mCAAO;AACHjB,0CAAUA;AADP;AAFe,yBAAb,CALO;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAApB;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAaA,IAAIkB;AAAA,2EAAc,kBAAMC,EAAN;AAAA;AAAA;AAAA;AAAA;AACdA,6BAAKC,SAASD,EAAT,CAAL;;AADc,8BAEVA,MAAM,CAFI;AAAA;AAAA;AAAA;;AAAA,0DAGH,EAHG;;AAAA;AAAA;AAAA,+BAKDvB,GAAGoB,SAAH,CAAa;AACtBH,uCAAW,QADW;AAEtBI,mCAAO;AACHE,oCAAIA;AADD;AAFe,yBAAb,CALC;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAd;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAaA,IAAIE;AAAA,2EAAiB,kBAAMZ,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACJb,GAAGoB,SAAH,CAAa;AACtBH,uCAAW,QADW;AAEtBI,mCAAO;AACHR,uCAAOA;AADJ;AAFe,yBAAb,CADI;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAjB;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAUAa,OAAOC,OAAP,GAAiB;AACbxB,gBAAYA,UADC;AAEbgB,uBAAmBA,iBAFN;AAGbG,iBAAaA,WAHA;AAIbG,oBAAgBA;AAJH,CAAjB","file":"user.js","sourcesContent":["/**\n * Created by linfeiyang on 16-11-3.\n */\n\nvar db = require('./db');\nvar md5 = require('blueimp-md5');\n\nvar createUser = async(username, password) => {\n    username = username || '';\n    if (!/\\w{2,16}/.test(username)) {\n        throw new Error(`用户名长度必须为2-16的数字和字母组合`)\n    }\n    password = password || '';\n    if (password.length < 4 || password.length > 16) {\n        throw new Error(`密码必须为4-16位`)\n    }\n    let now = Date.now();\n    let user = {\n        username: username,\n        password: md5(password),\n        lastTime: now,\n        token: md5(`${username}-${password}-${Date.now()}`),\n        createTime: now,\n        url: `/${username}`\n    };\n    await db.smartyAddAsync({\n        tableName: 't_user',\n        model: user\n    });\n    return `/${username}`;\n};\n\n\nvar getUserByUsername = async(username) => {\n    username = username || '';\n    if (username == '') {\n        return {};\n    }\n    return await db.findAsync({\n        tableName: 't_user',\n        where: {\n            username: username\n        }\n    });\n};\n\nvar getUserById = async(id) => {\n    id = parseInt(id);\n    if (id <= 0) {\n        return {};\n    }\n    return await db.findAsync({\n        tableName: 't_user',\n        where: {\n            id: id\n        }\n    });\n};\n\nvar getUserByToken = async(token) => {\n    return await db.findAsync({\n        tableName: 't_user',\n        where: {\n            token: token\n        }\n    });\n};\n\n\nmodule.exports = {\n    createUser: createUser,\n    getUserByUsername: getUserByUsername,\n    getUserById: getUserById,\n    getUserByToken: getUserByToken\n};"]}