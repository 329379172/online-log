{"version":3,"sources":["../../src/action/log.js"],"names":["logService","require","createLog","ctx","userId","parseInt","Error","data","request","body","content","result","global","xiaoqiuLogs","push","username","user","level","timestamp","Date","now","status","code","message","statu","module","exports"],"mappings":";;;;;;;;;;;;AAGA,IAAMA,aAAaC,QAAQ,gBAAR,CAAnB;;AAEA,IAAIC;AAAA,0EAAY,iBAAMC,GAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,8BAEJ,OAAOA,IAAIC,MAAX,IAAqB,WAArB,IAAoC,CAACD,IAAIC,MAAzC,IAAmDC,SAASF,IAAIC,MAAb,KAAwB,CAFvE;AAAA;AAAA;AAAA;;AAAA,8BAGE,IAAIE,KAAJ,CAAU,QAAV,CAHF;;AAAA;AAKAC,4BALA,GAKOJ,IAAIK,OAAJ,CAAYC,IAAZ,IAAoB,EAL3B;;AAAA,4BAMAF,KAAKG,OANL;AAAA;AAAA;AAAA;;AAAA,8BAOM,IAAIJ,KAAJ,CAAU,UAAV,CAPN;;AAAA;AASJC,6BAAKH,MAAL,GAAcD,IAAIC,MAAlB;AATI;AAAA,+BAUeJ,WAAWE,SAAX,CAAqBK,IAArB,CAVf;;AAAA;AAUAI,8BAVA;;AAAA,4BAWAA,MAXA;AAAA;AAAA;AAAA;;AAAA,8BAYM,IAAIL,KAAJ,CAAU,QAAV,CAZN;;AAAA;AAcJM,+BAAOC,WAAP,CAAmBC,IAAnB,CAAwB;AACpBC,sCAAUZ,IAAIa,IAAJ,CAASD,QADC;AAEpBE,mCAAOV,KAAKU,KAAL,IAAc,MAFD;AAGpBP,qCAASH,KAAKG,OAHM;AAIpBQ,uCAAWC,KAAKC,GAAL;AAJS,yBAAxB;AAMAjB,4BAAIkB,MAAJ,GAAa,GAAb;AACAlB,4BAAIM,IAAJ,GAAW;AACPa,kCAAM,GADC;AAEPC,qCAAS,IAFF;AAGPhB,kCAAMI,MAHC;AAIPO,uCAAWC,KAAKC,GAAL;AAJJ,yBAAX;;AArBI;AAAA;AAAA;;AAAA;AAAA;AAAA;;AA6BRjB,4BAAIqB,KAAJ,GAAY,GAAZ;AACArB,4BAAIM,IAAJ,GAAW;AACPa,kCAAM,GADC;AAEPC,qCAAS,YAAIA,OAFN;AAGPL,uCAAWC,KAAKC,GAAL;AAHJ,yBAAX;;AA9BQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAZ;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAsCAK,OAAOC,OAAP,GAAiB;AACbxB,eAAWA;AADE,CAAjB","file":"log.js","sourcesContent":["/**\n * Created by linfeiyang on 16-11-4.\n */\nconst logService = require('../service/log');\n\nvar createLog = async(ctx) => {\n    try {\n        if (typeof ctx.userId == 'undefined' || !ctx.userId || parseInt(ctx.userId) <= 0) {\n            throw new Error('未授权的请求');\n        } else {\n            let data = ctx.request.body || {};\n            if(!data.content) {\n                throw new Error('日志内容不能为空');\n            }\n            data.userId = ctx.userId;\n            let result = await logService.createLog(data);\n            if(!result) {\n                throw new Error('添加日志失败');\n            }\n            global.xiaoqiuLogs.push({\n                username: ctx.user.username,\n                level: data.level || 'info',\n                content: data.content,\n                timestamp: Date.now()\n            });\n            ctx.status = 200;\n            ctx.body = {\n                code: 200,\n                message: 'ok',\n                data: result,\n                timestamp: Date.now()\n            };\n        }\n    } catch (err) {\n        ctx.statu = 200;\n        ctx.body = {\n            code: 400,\n            message: err.message,\n            timestamp: Date.now()\n        };\n    }\n};\n\nmodule.exports = {\n    createLog: createLog\n};"]}