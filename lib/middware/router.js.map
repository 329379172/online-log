{"version":3,"sources":["../../src/middware/router.js"],"names":["common","require","path","userService","notFound","ctx","type","readFileAsync","join","resolve","__dirname","body","login","next","query","token","getUserByToken","user","console","log","id","userId","module","exports"],"mappings":";;;;;;;;;;;;AAIA,IAAMA,SAASC,QAAQ,eAAR,CAAf;AACA,IAAMC,OAAOD,QAAQ,MAAR,CAAb;AACA,IAAME,cAAcF,QAAQ,iBAAR,CAApB;;AAEA,IAAIG;AAAA,0EAAW,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AACXA,4BAAIC,IAAJ,GAAW,WAAX;AADW;AAAA,+BAEMN,OAAOO,aAAP,CAAqBL,KAAKM,IAAL,CAAUN,KAAKO,OAAL,CAAaC,SAAb,EAAwB,mBAAxB,CAAV,EAAwD,YAAxD,CAArB,CAFN;;AAAA;AAEXL,4BAAIM,IAFO;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAX;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAKA,IAAIC;AAAA,2EAAQ,kBAAOP,GAAP,EAAYQ,IAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4BACH,CAACR,IAAIS,KAAJ,CAAUC,KADR;AAAA;AAAA;AAAA;;AAAA;AAAA,+BAEaZ,YAAYa,cAAZ,CAA2BX,IAAIS,KAAJ,CAAUC,KAArC,CAFb;;AAAA;AAEAE,4BAFA;;AAGJC,gCAAQC,GAAR,CAAYF,IAAZ;AACA,4BAAG,CAAC,CAACA,IAAF,IAAUA,KAAKG,EAAL,GAAU,CAAvB,EAA0B;AACtBf,gCAAIgB,MAAJ,GAAaJ,KAAKG,EAAlB;AACAf,gCAAIY,IAAJ,GAAWA,IAAX;AACH;;AAPG;AAAA;AAAA,+BASFJ,MATE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAR;;AAAA;AAAA;AAAA;AAAA,GAAJ;;AAYAS,OAAOC,OAAP,GAAiB;AACbnB,cAAUA,QADG;AAEbQ,WAAOA;AAFM,CAAjB","file":"router.js","sourcesContent":["/**\n * Created by linfeiyang on 16-11-2.\n */\n\nconst common = require('../lib/common');\nconst path = require('path');\nconst userService = require('../service/user');\n\nvar notFound = async (ctx) => {\n    ctx.type = 'text/html';\n    ctx.body = await common.readFileAsync(path.join(path.resolve(__dirname, '../../public/dist'), 'index.html'));\n};\n\nvar login = async (ctx, next) => {\n    if (!!ctx.query.token) {\n        let user = await userService.getUserByToken(ctx.query.token);\n        console.log(user);\n        if(!!user && user.id > 0) {\n            ctx.userId = user.id;\n            ctx.user = user;\n        }\n    }\n    await next();\n};\n\nmodule.exports = {\n    notFound: notFound,\n    login: login\n};"]}